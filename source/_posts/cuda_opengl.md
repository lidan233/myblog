---
title: cuda and opengl 
---

There are five important api for the Interoperability between opengl and cuda. 

We often use cuda to generate some new image as the textures or buffers of opengl. 

I don't know the relationship between cuda context and opengl context (opengl version provided by nvidia). But I implement the interaction of opengl and cuda. I find that

the interaction process between opengl context and cuda context  is basically the same as the interaction process between cuda context  and cuda context.

There are five important api for the interaction of cuda and opengl context.

> cudaGraphicsGLRegisterImage 

If you want to provide texture image generated by cuda to opengl context, you must register this opengl texture hander in cuda context.  

just link:

 

```
glGenTextures(1,gl_tex) ;
glBindTexture(GL_TEXTURE_2D,*gl_tex) ;
glTexParameteri(GL_TEXTURE_2D,GL_TEXTURE_WRAP_S,GL_CLAMP_TO_EDGE) ;
GLTexParameteri(GL_TEXTURE_2D,GL_TEXTURE_WRAP_T,GL_CLAMP_TO_EDGE) ;
glTexParameteri(GL_TEXTURE_2D_GL_TEXTURE_MIN_FILTER,GL_NEAREST) ;
glTexParameteri(GL_TEXTURE_2D_GL_TEXTURE_MAX_F5ILTER,GL_NEAREST) ;

glTexImage2D(GL_TEXTURE_2D,0,GL_RGBA8UI,size_x,size_y ,0, GL_RGBA_INTEGER, GL_UNSIGNED_BYTE,NULL) ;
checkCudaErrors(cudaGraphicsGLRegisterImage(cuda_tex,*gl_tex,GL_TEXTURE_2D,cudaGraphicsRegisterGLagsWriteDiscard)) ;

SDK_CHECK_ERROR_GL() ;
```

We use cudagraphicsglregisterImage api to register this gl_tex(opengl texture handler) to cuda just use resource.

So we can use cuda to map this resouce to array. 

> cudaGraphicsMapResouce

We want use map this resource, so we can touch this resource in cuda context. Maybe this is just hander.

If you want to access the cudaResource, you must map it. 

> The graphics API from which `resources` were registered should not access any resources while they are mapped by CUDA. If an application does so, the results are undefined.

So the cuda context use this resource only.

So we can see these resource are be registered as

> cudaGraphicsSubResouceGetMappedArray(&texture_ptr,cuda_tex_resource,0,0) 

We map this cuda tex resouce to texture ptr (cuda array).

And we use memory to array,use this textureptr another buffer.

> cudaMemoryToArray 

We use cuda memory to array api to copy cuda

_dev_render_buffer to textureptr. 

> ```
> cudaGraphicsUnmapResources
> ```

. 

So we use register， use map，get array pointer*， memcpytoarray。

to save cuda buffer to texture data.